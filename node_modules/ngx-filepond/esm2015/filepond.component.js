import { __decorate } from "tslib";
import { Component, ElementRef, SimpleChanges, ViewEncapsulation, EventEmitter, NgZone, Input, Output, AfterViewInit, OnChanges, OnDestroy, } from "@angular/core";
import { create, supported } from "filepond";
// We test if filepond is supported on the current client
const isSupported = supported();
// List of attributes for fallback input
const inputAttributes = [
    "id",
    "name",
    "class",
    "multiple",
    "required",
    "disabled",
    "capture",
    "accept",
];
// Methods not made available on the component
const filteredComponentMethods = [
    "setOptions",
    "on",
    "off",
    "onOnce",
    "appendTo",
    "insertAfter",
    "insertBefore",
    "isAttachedTo",
    "replaceElement",
    "restoreElement",
    "destroy",
];
const outputs = [
    "oninit",
    "onwarning",
    "onerror",
    "onactivatefile",
    "onaddfilestart",
    "onaddfileprogress",
    "onaddfile",
    "onprocessfilestart",
    "onprocessfileprogress",
    "onprocessfileabort",
    "onprocessfilerevert",
    "onprocessfile",
    "onprocessfiles",
    "onremovefile",
    "onpreparefile",
    "onupdatefiles",
];
// Component outline
let FilePondComponent = class FilePondComponent {
    constructor(root, zone) {
        this.options = {};
        // same as outputs array
        this.oninit = new EventEmitter();
        this.onwarning = new EventEmitter();
        this.onerror = new EventEmitter();
        this.onactivatefile = new EventEmitter();
        this.onaddfilestart = new EventEmitter();
        this.onaddfileprogress = new EventEmitter();
        this.onaddfile = new EventEmitter();
        this.onprocessfilestart = new EventEmitter();
        this.onprocessfileprogress = new EventEmitter();
        this.onprocessfileabort = new EventEmitter();
        this.onprocessfilerevert = new EventEmitter();
        this.onprocessfile = new EventEmitter();
        this.onprocessfiles = new EventEmitter();
        this.onremovefile = new EventEmitter();
        this.onpreparefile = new EventEmitter();
        this.onupdatefiles = new EventEmitter();
        this.handleEvent = null;
        this.root = root;
        this.zone = zone;
    }
    ngAfterViewInit() {
        const input = this.root.nativeElement.querySelector("input");
        // transfer relevant attributes to input, this so we still have an input with the correct attributes should file pond not load
        const attributes = this.root.nativeElement.attributes;
        inputAttributes.forEach((name) => {
            const value = attributes[name]
                ? attributes[name].value
                : this.options[name];
            if (!value) {
                return;
            }
            input.setAttribute(name, value);
        });
        // no sufficient features supported in this browser
        if (!isSupported) {
            return;
        }
        // map FilePond events to Angular @outputs
        this.handleEvent = (e) => {
            this[`on${e.type.split(":")[1]}`].emit(Object.assign({}, e.detail));
        };
        outputs.forEach((event) => {
            this.root.nativeElement.addEventListener(`FilePond:${event.substr(2)}`, this.handleEvent);
        });
        // will block angular from listening to events inside the pond
        this.zone.runOutsideAngular(() => {
            // create instance
            this.pond = create(input, Object.assign(Object.assign({}, this.options), { 
                // our initial files
                files: this.files }));
        });
        // Copy instance method references to component instance
        Object.keys(this.pond)
            // remove unwanted methods
            .filter((key) => filteredComponentMethods.indexOf(key) === -1)
            // set method references from the component instance to the pond instance
            .forEach((key) => {
            this[key] = this.pond[key];
        });
    }
    ngOnChanges(changes) {
        // no need to handle first change
        if (changes.firstChange) {
            return;
        }
        // no filepond instance available
        if (!this.pond) {
            return;
        }
        // use new options object as base ( or if not available, use current options )
        const options = changes.options
            ? changes.options.currentValue
            : this.options;
        // see if file list has changed
        if (changes.files &&
            JSON.stringify(changes.files.previousValue) !==
                JSON.stringify(changes.files.currentValue)) {
            // file list has changed
            options.files = changes.files.currentValue;
        }
        // set new options
        this.pond.setOptions(options);
    }
    ngOnDestroy() {
        if (!this.pond) {
            return;
        }
        outputs.forEach((event) => {
            this.root.nativeElement.removeEventListener(`FilePond:${event.substr(2)}`, this.handleEvent);
        });
        this.pond.destroy();
    }
};
FilePondComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone }
];
__decorate([
    Input()
], FilePondComponent.prototype, "options", void 0);
__decorate([
    Input()
], FilePondComponent.prototype, "files", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "oninit", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onwarning", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onerror", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onactivatefile", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onaddfilestart", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onaddfileprogress", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onaddfile", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfilestart", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfileprogress", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfileabort", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfilerevert", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfile", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onprocessfiles", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onremovefile", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onpreparefile", void 0);
__decorate([
    Output()
], FilePondComponent.prototype, "onupdatefiles", void 0);
FilePondComponent = __decorate([
    Component({
        selector: "file-pond",
        encapsulation: ViewEncapsulation.None,
        template: "<div class=\"filepond--wrapper\">\n  <input type=\"file\"/>\n</div>",
        styles: [""]
    })
], FilePondComponent);
export { FilePondComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXBvbmQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWZpbGVwb25kLyIsInNvdXJjZXMiOlsiZmlsZXBvbmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixhQUFhLEVBQ2IsaUJBQWlCLEVBQ2pCLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sRUFDTixhQUFhLEVBQ2IsU0FBUyxFQUNULFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBNkIsTUFBTSxVQUFVLENBQUM7QUFFeEUseURBQXlEO0FBQ3pELE1BQU0sV0FBVyxHQUFZLFNBQVMsRUFBRSxDQUFDO0FBRXpDLHdDQUF3QztBQUN4QyxNQUFNLGVBQWUsR0FBa0I7SUFDckMsSUFBSTtJQUNKLE1BQU07SUFDTixPQUFPO0lBQ1AsVUFBVTtJQUNWLFVBQVU7SUFDVixVQUFVO0lBQ1YsU0FBUztJQUNULFFBQVE7Q0FDVCxDQUFDO0FBRUYsOENBQThDO0FBQzlDLE1BQU0sd0JBQXdCLEdBQWtCO0lBQzlDLFlBQVk7SUFDWixJQUFJO0lBQ0osS0FBSztJQUNMLFFBQVE7SUFDUixVQUFVO0lBQ1YsYUFBYTtJQUNiLGNBQWM7SUFDZCxjQUFjO0lBQ2QsZ0JBQWdCO0lBQ2hCLGdCQUFnQjtJQUNoQixTQUFTO0NBQ1YsQ0FBQztBQUVGLE1BQU0sT0FBTyxHQUFrQjtJQUM3QixRQUFRO0lBQ1IsV0FBVztJQUNYLFNBQVM7SUFDVCxnQkFBZ0I7SUFDaEIsZ0JBQWdCO0lBQ2hCLG1CQUFtQjtJQUNuQixXQUFXO0lBQ1gsb0JBQW9CO0lBQ3BCLHVCQUF1QjtJQUN2QixvQkFBb0I7SUFDcEIscUJBQXFCO0lBQ3JCLGVBQWU7SUFDZixnQkFBZ0I7SUFDaEIsY0FBYztJQUNkLGVBQWU7SUFDZixlQUFlO0NBQ2hCLENBQUM7QUFFRixvQkFBb0I7QUFPcEIsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUE4QjVCLFlBQVksSUFBZ0IsRUFBRSxJQUFZO1FBNUIxQyxZQUFPLEdBQW9CLEVBQUUsQ0FBQztRQUs5Qix3QkFBd0I7UUFDZCxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNqQyxjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNwQyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNsQyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3pDLHNCQUFpQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDNUMsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDcEMsdUJBQWtCLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUM3QywwQkFBcUIsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ2hELHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDN0Msd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUM5QyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDeEMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3pDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2QyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDeEMsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBSzFDLGdCQUFXLEdBQWEsSUFBSSxDQUFDO1FBR25DLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFFRCxlQUFlO1FBQ2IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTdELDhIQUE4SDtRQUM5SCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUM7UUFDdEQsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQy9CLE1BQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7Z0JBQzVCLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSztnQkFDeEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDVixPQUFPO2FBQ1I7WUFDRCxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztRQUVILG1EQUFtRDtRQUNuRCxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2hCLE9BQU87U0FDUjtRQUVELDBDQUEwQztRQUMxQyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDdkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksbUJBQU0sQ0FBQyxDQUFDLE1BQU0sRUFBRyxDQUFDO1FBQzFELENBQUMsQ0FBQztRQUNGLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FDdEMsWUFBWSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQzdCLElBQUksQ0FBQyxXQUFXLENBQ2pCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILDhEQUE4RDtRQUM5RCxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUMvQixrQkFBa0I7WUFDbEIsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxrQ0FFbkIsSUFBSSxDQUFDLE9BQU87Z0JBRWYsb0JBQW9CO2dCQUNwQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssSUFDakIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsd0RBQXdEO1FBQ3hELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUVwQiwwQkFBMEI7YUFDekIsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyx3QkFBd0IsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFFOUQseUVBQXlFO2FBQ3hFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLGlDQUFpQztRQUNqQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUU7WUFDdkIsT0FBTztTQUNSO1FBRUQsaUNBQWlDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2QsT0FBTztTQUNSO1FBRUQsOEVBQThFO1FBQzlFLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPO1lBQzdCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVk7WUFDOUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFFakIsK0JBQStCO1FBQy9CLElBQ0UsT0FBTyxDQUFDLEtBQUs7WUFDYixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDO2dCQUN6QyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEVBQzVDO1lBQ0Esd0JBQXdCO1lBQ3hCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUM7U0FDNUM7UUFFRCxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNkLE9BQU87U0FDUjtRQUVELE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FDekMsWUFBWSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQzdCLElBQUksQ0FBQyxXQUFXLENBQ2pCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDdEIsQ0FBQztDQUNGLENBQUE7O1lBeEdtQixVQUFVO1lBQVEsTUFBTTs7QUE1QjFDO0lBREMsS0FBSyxFQUFFO2tEQUNzQjtBQUc5QjtJQURDLEtBQUssRUFBRTtnREFDd0I7QUFHdEI7SUFBVCxNQUFNLEVBQUU7aURBQWtDO0FBQ2pDO0lBQVQsTUFBTSxFQUFFO29EQUFxQztBQUNwQztJQUFULE1BQU0sRUFBRTtrREFBbUM7QUFDbEM7SUFBVCxNQUFNLEVBQUU7eURBQTBDO0FBQ3pDO0lBQVQsTUFBTSxFQUFFO3lEQUEwQztBQUN6QztJQUFULE1BQU0sRUFBRTs0REFBNkM7QUFDNUM7SUFBVCxNQUFNLEVBQUU7b0RBQXFDO0FBQ3BDO0lBQVQsTUFBTSxFQUFFOzZEQUE4QztBQUM3QztJQUFULE1BQU0sRUFBRTtnRUFBaUQ7QUFDaEQ7SUFBVCxNQUFNLEVBQUU7NkRBQThDO0FBQzdDO0lBQVQsTUFBTSxFQUFFOzhEQUErQztBQUM5QztJQUFULE1BQU0sRUFBRTt3REFBeUM7QUFDeEM7SUFBVCxNQUFNLEVBQUU7eURBQTBDO0FBQ3pDO0lBQVQsTUFBTSxFQUFFO3VEQUF3QztBQUN2QztJQUFULE1BQU0sRUFBRTt3REFBeUM7QUFDeEM7SUFBVCxNQUFNLEVBQUU7d0RBQXlDO0FBdkJ2QyxpQkFBaUI7SUFON0IsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLFdBQVc7UUFDckIsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7UUFDckMsK0VBQXdDOztLQUV6QyxDQUFDO0dBQ1csaUJBQWlCLENBc0k3QjtTQXRJWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBFdmVudEVtaXR0ZXIsXG4gIE5nWm9uZSxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IGNyZWF0ZSwgc3VwcG9ydGVkLCBGaWxlUG9uZCwgRmlsZVBvbmRPcHRpb25zIH0gZnJvbSBcImZpbGVwb25kXCI7XG5cbi8vIFdlIHRlc3QgaWYgZmlsZXBvbmQgaXMgc3VwcG9ydGVkIG9uIHRoZSBjdXJyZW50IGNsaWVudFxuY29uc3QgaXNTdXBwb3J0ZWQ6IEJvb2xlYW4gPSBzdXBwb3J0ZWQoKTtcblxuLy8gTGlzdCBvZiBhdHRyaWJ1dGVzIGZvciBmYWxsYmFjayBpbnB1dFxuY29uc3QgaW5wdXRBdHRyaWJ1dGVzOiBBcnJheTxzdHJpbmc+ID0gW1xuICBcImlkXCIsXG4gIFwibmFtZVwiLFxuICBcImNsYXNzXCIsXG4gIFwibXVsdGlwbGVcIixcbiAgXCJyZXF1aXJlZFwiLFxuICBcImRpc2FibGVkXCIsXG4gIFwiY2FwdHVyZVwiLFxuICBcImFjY2VwdFwiLFxuXTtcblxuLy8gTWV0aG9kcyBub3QgbWFkZSBhdmFpbGFibGUgb24gdGhlIGNvbXBvbmVudFxuY29uc3QgZmlsdGVyZWRDb21wb25lbnRNZXRob2RzOiBBcnJheTxzdHJpbmc+ID0gW1xuICBcInNldE9wdGlvbnNcIixcbiAgXCJvblwiLFxuICBcIm9mZlwiLFxuICBcIm9uT25jZVwiLFxuICBcImFwcGVuZFRvXCIsXG4gIFwiaW5zZXJ0QWZ0ZXJcIixcbiAgXCJpbnNlcnRCZWZvcmVcIixcbiAgXCJpc0F0dGFjaGVkVG9cIixcbiAgXCJyZXBsYWNlRWxlbWVudFwiLFxuICBcInJlc3RvcmVFbGVtZW50XCIsXG4gIFwiZGVzdHJveVwiLFxuXTtcblxuY29uc3Qgb3V0cHV0czogQXJyYXk8c3RyaW5nPiA9IFtcbiAgXCJvbmluaXRcIixcbiAgXCJvbndhcm5pbmdcIixcbiAgXCJvbmVycm9yXCIsXG4gIFwib25hY3RpdmF0ZWZpbGVcIixcbiAgXCJvbmFkZGZpbGVzdGFydFwiLFxuICBcIm9uYWRkZmlsZXByb2dyZXNzXCIsXG4gIFwib25hZGRmaWxlXCIsXG4gIFwib25wcm9jZXNzZmlsZXN0YXJ0XCIsXG4gIFwib25wcm9jZXNzZmlsZXByb2dyZXNzXCIsXG4gIFwib25wcm9jZXNzZmlsZWFib3J0XCIsXG4gIFwib25wcm9jZXNzZmlsZXJldmVydFwiLFxuICBcIm9ucHJvY2Vzc2ZpbGVcIixcbiAgXCJvbnByb2Nlc3NmaWxlc1wiLFxuICBcIm9ucmVtb3ZlZmlsZVwiLFxuICBcIm9ucHJlcGFyZWZpbGVcIixcbiAgXCJvbnVwZGF0ZWZpbGVzXCIsXG5dO1xuXG4vLyBDb21wb25lbnQgb3V0bGluZVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcImZpbGUtcG9uZFwiLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICB0ZW1wbGF0ZVVybDogXCIuL2ZpbGVwb25kLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9maWxlcG9uZC5jb21wb25lbnQuY3NzXCJdLFxufSlcbmV4cG9ydCBjbGFzcyBGaWxlUG9uZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KClcbiAgb3B0aW9uczogRmlsZVBvbmRPcHRpb25zID0ge307XG5cbiAgQElucHV0KClcbiAgZmlsZXM6IEZpbGVQb25kT3B0aW9uc1tcImZpbGVzXCJdO1xuXG4gIC8vIHNhbWUgYXMgb3V0cHV0cyBhcnJheVxuICBAT3V0cHV0KCkgb25pbml0ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbndhcm5pbmcgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uYWN0aXZhdGVmaWxlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbmFkZGZpbGVzdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25hZGRmaWxlcHJvZ3Jlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uYWRkZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbnByb2Nlc3NmaWxlcHJvZ3Jlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9ucHJvY2Vzc2ZpbGVhYm9ydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXJldmVydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXMgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9ucmVtb3ZlZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcmVwYXJlZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb251cGRhdGVmaWxlcyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIHByaXZhdGUgcm9vdDogRWxlbWVudFJlZjtcbiAgcHJpdmF0ZSB6b25lOiBOZ1pvbmU7XG4gIHByaXZhdGUgcG9uZDogRmlsZVBvbmQ7XG4gIHByaXZhdGUgaGFuZGxlRXZlbnQ6IEZ1bmN0aW9uID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihyb290OiBFbGVtZW50UmVmLCB6b25lOiBOZ1pvbmUpIHtcbiAgICB0aGlzLnJvb3QgPSByb290O1xuICAgIHRoaXMuem9uZSA9IHpvbmU7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgaW5wdXQgPSB0aGlzLnJvb3QubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG5cbiAgICAvLyB0cmFuc2ZlciByZWxldmFudCBhdHRyaWJ1dGVzIHRvIGlucHV0LCB0aGlzIHNvIHdlIHN0aWxsIGhhdmUgYW4gaW5wdXQgd2l0aCB0aGUgY29ycmVjdCBhdHRyaWJ1dGVzIHNob3VsZCBmaWxlIHBvbmQgbm90IGxvYWRcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5yb290Lm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcztcbiAgICBpbnB1dEF0dHJpYnV0ZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBhdHRyaWJ1dGVzW25hbWVdXG4gICAgICAgID8gYXR0cmlidXRlc1tuYW1lXS52YWx1ZVxuICAgICAgICA6IHRoaXMub3B0aW9uc1tuYW1lXTtcbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICB9KTtcblxuICAgIC8vIG5vIHN1ZmZpY2llbnQgZmVhdHVyZXMgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclxuICAgIGlmICghaXNTdXBwb3J0ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBtYXAgRmlsZVBvbmQgZXZlbnRzIHRvIEFuZ3VsYXIgQG91dHB1dHNcbiAgICB0aGlzLmhhbmRsZUV2ZW50ID0gKGUpID0+IHtcbiAgICAgIHRoaXNbYG9uJHtlLnR5cGUuc3BsaXQoXCI6XCIpWzFdfWBdLmVtaXQoeyAuLi5lLmRldGFpbCB9KTtcbiAgICB9O1xuICAgIG91dHB1dHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMucm9vdC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIGBGaWxlUG9uZDoke2V2ZW50LnN1YnN0cigyKX1gLFxuICAgICAgICB0aGlzLmhhbmRsZUV2ZW50XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8gd2lsbCBibG9jayBhbmd1bGFyIGZyb20gbGlzdGVuaW5nIHRvIGV2ZW50cyBpbnNpZGUgdGhlIHBvbmRcbiAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgLy8gY3JlYXRlIGluc3RhbmNlXG4gICAgICB0aGlzLnBvbmQgPSBjcmVhdGUoaW5wdXQsIHtcbiAgICAgICAgLy8gb3VyIG9wdGlvbnNcbiAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuXG4gICAgICAgIC8vIG91ciBpbml0aWFsIGZpbGVzXG4gICAgICAgIGZpbGVzOiB0aGlzLmZpbGVzLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBDb3B5IGluc3RhbmNlIG1ldGhvZCByZWZlcmVuY2VzIHRvIGNvbXBvbmVudCBpbnN0YW5jZVxuICAgIE9iamVjdC5rZXlzKHRoaXMucG9uZClcblxuICAgICAgLy8gcmVtb3ZlIHVud2FudGVkIG1ldGhvZHNcbiAgICAgIC5maWx0ZXIoKGtleSkgPT4gZmlsdGVyZWRDb21wb25lbnRNZXRob2RzLmluZGV4T2Yoa2V5KSA9PT0gLTEpXG5cbiAgICAgIC8vIHNldCBtZXRob2QgcmVmZXJlbmNlcyBmcm9tIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdG8gdGhlIHBvbmQgaW5zdGFuY2VcbiAgICAgIC5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgdGhpc1trZXldID0gdGhpcy5wb25kW2tleV07XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvLyBubyBuZWVkIHRvIGhhbmRsZSBmaXJzdCBjaGFuZ2VcbiAgICBpZiAoY2hhbmdlcy5maXJzdENoYW5nZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG5vIGZpbGVwb25kIGluc3RhbmNlIGF2YWlsYWJsZVxuICAgIGlmICghdGhpcy5wb25kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gdXNlIG5ldyBvcHRpb25zIG9iamVjdCBhcyBiYXNlICggb3IgaWYgbm90IGF2YWlsYWJsZSwgdXNlIGN1cnJlbnQgb3B0aW9ucyApXG4gICAgY29uc3Qgb3B0aW9ucyA9IGNoYW5nZXMub3B0aW9uc1xuICAgICAgPyBjaGFuZ2VzLm9wdGlvbnMuY3VycmVudFZhbHVlXG4gICAgICA6IHRoaXMub3B0aW9ucztcblxuICAgIC8vIHNlZSBpZiBmaWxlIGxpc3QgaGFzIGNoYW5nZWRcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLmZpbGVzICYmXG4gICAgICBKU09OLnN0cmluZ2lmeShjaGFuZ2VzLmZpbGVzLnByZXZpb3VzVmFsdWUpICE9PVxuICAgICAgICBKU09OLnN0cmluZ2lmeShjaGFuZ2VzLmZpbGVzLmN1cnJlbnRWYWx1ZSlcbiAgICApIHtcbiAgICAgIC8vIGZpbGUgbGlzdCBoYXMgY2hhbmdlZFxuICAgICAgb3B0aW9ucy5maWxlcyA9IGNoYW5nZXMuZmlsZXMuY3VycmVudFZhbHVlO1xuICAgIH1cblxuICAgIC8vIHNldCBuZXcgb3B0aW9uc1xuICAgIHRoaXMucG9uZC5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKCF0aGlzLnBvbmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBvdXRwdXRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnJvb3QubmF0aXZlRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICBgRmlsZVBvbmQ6JHtldmVudC5zdWJzdHIoMil9YCxcbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRoaXMucG9uZC5kZXN0cm95KCk7XG4gIH1cbn1cbiJdfQ==